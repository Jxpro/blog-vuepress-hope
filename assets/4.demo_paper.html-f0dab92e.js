import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as c,o as i,c as l,a as n,b as s,d as e,e as t}from"./app-5e6e2e94.js";const p={},r=n("h1",{id:"商业票据教程",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#商业票据教程","aria-hidden":"true"},"#"),s(" 商业票据教程")],-1),d=n("h2",{id:"场景说明",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#场景说明","aria-hidden":"true"},"#"),s(" 场景说明")],-1),u=n("strong",null,"更侧重的是流程而不是概念",-1),m={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/developapps/developing_applications.html",target:"_blank",rel:"noopener noreferrer"},b=t('<figure><img src="https://raw.githubusercontent.com/Jxpro/PicBed/master/md/2021/11/2021-11-18-215119.png" alt="commercialpaper.tutorial" tabindex="0" loading="lazy"><figcaption>commercialpaper.tutorial</figcaption></figure><blockquote><p><em>在本教程中，MagnetoCorp 和 DigiBank 这两个组织使用 Hyperledger Fabric 区块链网络 PaperNet 相互交易商业票据。</em></p></blockquote><ul><li>建立了基本的网络后，您就将扮演 MagnetoCorp 的员工 Isabella，她将代表公司发行商业票据。</li><li>然后，您将转换角色，担任 DigiBank 的员工 Balaji，他将购买此商业票据，持有一段时间，然后向 MagnetoCorp 赎回该商业票据，以获取小额利润。</li></ul><p>您将扮演<strong>开发人员，最终用户和管理员</strong>，这些角色位于不同组织中，都将执行以下步骤，这些步骤旨在帮助您了解作为两个不同组织独立工作，但要根据<code>Hyperledger Fabric</code>网络中双方共同商定的规则来进行协作是什么感觉。</p><h2 id="一、准备阶段" tabindex="-1"><a class="header-anchor" href="#一、准备阶段" aria-hidden="true">#</a> 一、准备阶段</h2><ol><li><p>安装<code>Nodejs</code></p></li><li><p>推荐安装<code>NVM</code>，以轻松切换不同版本的<code>Nodejs</code></p></li></ol><h2 id="二、下载示例" tabindex="-1"><a class="header-anchor" href="#二、下载示例" aria-hidden="true">#</a> 二、下载示例</h2>',7),g=n("code",null,"fabric-samples",-1),v={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/prereqs.html",target:"_blank",rel:"noopener noreferrer"},k={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/install.html",target:"_blank",rel:"noopener noreferrer"},h=t(`<p><img src="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/_images/commercial_paper.diagram.2.png" alt="commercialpaper.download" loading="lazy"> 下载 <code>fabric-samples</code> GitHub仓库到您的本地机器。</p><p>下载后，查看<code>fabric-samples</code>的目录结构:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> fabric-samples
$ <span class="token function">ls</span>
CODEOWNERS              SECURITY.md                 first-network
CODE_OF_CONDUCT.md      chaincode                   high-throughput
CONTRIBUTING.md         chaincode-docker-devmode    interest_rate_swaps
LICENSE                 ci                          off_chain_data
MAINTAINERS.md          commercial-paper            test-network
README.md               fabcar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意 <code>commercial-paper</code> 目录，教程示例就在这里！</p><p>随着继续操作，您将为不同用户和组件打开多个命令窗口。例如：</p><ul><li>显示网络的<code>peer</code>节点、排序服务节点和<code>CA</code>日志输出。</li><li>作为 MagnetoCorp 组织和 DigiBank 组织的管理员， 审批同意链码。</li><li>代表 Isabella 和 Balaji 运行应用程序， 他们将使用智能合约彼此交易商业票据。</li></ul><p>当您应该从特定命令窗口运行一项命令时，我们将详细说明这一点。例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ <span class="token function">ls</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这表示您应该在 Isabella 的窗口中执行 <code>ls</code> 命令。</p><h2 id="三、创建网络" tabindex="-1"><a class="header-anchor" href="#三、创建网络" aria-hidden="true">#</a> 三、创建网络</h2><p>本教程将使用<code>Fabric</code>测试网络部署智能合约。 测试网络由<strong>两个peer组织和一个排序服务组织</strong>组成。 两个peer组织各自操作一个peer节点， 而排序服务组织操作<strong>单个Raft排序服务节点</strong>。 我们还将使用测试网络创建一个名为<code>mychannel</code>的单一通道， 两个peer组织都将是该通道的成员。</p><figure><img src="https://raw.githubusercontent.com/Jxpro/PicBed/master/md/2021/11/2021-11-18-220136.png" alt="commercialpaper.network" tabindex="0" loading="lazy"><figcaption>commercialpaper.network</figcaption></figure>`,12),f=n("p",null,[n("em",null,"The Hyperledger Fabric 基础网络的组成部分包括一个节点及该节点的账本数据库，一个排序服务和一个证书授权中心。以上每个组件都在一个 Docker 容器中运行。")],-1),q={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/ledger/ledger.html#world-state-database-options",target:"_blank",rel:"noopener noreferrer"},_=n("p",null,"测试网络的两个组织允许我们以两个独立的组织形式， 操作不同的peer节点与一个区块链帐本交互。",-1),C=t(`<p>在本教程中，您将作为 DigiBank 操作测试网络中的<code>Org1</code>以及作为 MagnetoCorp 操作<code>Org2</code></p><p>首先，进入到<code>fabric-samples</code>中的<code>commercial-paper</code>目录:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> fabric-samples/commercial-paper
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后使用脚本启动测试网络:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./network-starter.sh

<span class="token comment"># 过程摘录</span>
<span class="token comment"># 停止网络</span>
<span class="token punctuation">..</span>.
Stopping network
<span class="token punctuation">..</span>.
./network.sh up createChannel <span class="token parameter variable">-ca</span> <span class="token parameter variable">-s</span> couchdb

Creating channel <span class="token string">&#39;mychannel&#39;</span><span class="token builtin class-name">.</span>
If network is not up, starting nodes with CLI <span class="token function">timeout</span> of <span class="token string">&#39;5&#39;</span> tries and CLI delay of <span class="token string">&#39;3&#39;</span> seconds and using database <span class="token string">&#39;couchdb with crypto from &#39;</span>Certificate Authorities<span class="token string">&#39;

# 启动网络
Bringing up network
LOCAL_VERSION=2.3.3
DOCKER_IMAGE_VERSION=2.3.3
CA_LOCAL_VERSION=1.5.2
CA_DOCKER_IMAGE_VERSION=1.5.2
Generating certificates using Fabric CA
Creating network &quot;fabric_test&quot; with the default driver
Creating ca_org2    ... done
Creating ca_orderer ... done
Creating ca_org1    ... done

Creating Org1 Identities
...
Creating Org2 Identities
...
Creating Orderer Org Identities
...
Generating CCP files for Org1 and Org2
...
Creating couchdb1            ... done
Creating orderer.example.com    ... done
Creating couchdb0               ... done
Creating peer0.org2.example.com ... done
Creating peer0.org1.example.com ... done
Creating cli                    ... done
...

# 建立通道
Generating channel genesis block &#39;</span>mychannel.block<span class="token string">&#39;
...
Channel &#39;</span>mychannel<span class="token string">&#39; created
...
Anchor peer set for org &#39;</span>Org1MSP<span class="token string">&#39; on channel &#39;</span>mychannel<span class="token string">&#39;
...
Anchor peer set for org &#39;</span>Org2MSP<span class="token string">&#39; on channel &#39;</span>mychannel<span class="token string">&#39;
Channel &#39;</span>mychannel&#39; joined

<span class="token comment"># Copy the connection profiles so they are in the correct organizations.</span>
<span class="token function">cp</span> <span class="token punctuation">..</span>.
<span class="token function">cp</span> <span class="token punctuation">..</span>.
<span class="token builtin class-name">.</span>

<span class="token builtin class-name">echo</span> Suggest that you monitor the <span class="token function">docker</span> containers by running
Suggest that you monitor the <span class="token function">docker</span> containers by running
<span class="token builtin class-name">echo</span> <span class="token string">&quot;./organization/magnetocorp/configuration/cli/monitordocker.sh fabric_test&quot;</span>
./organization/magnetocorp/configuration/cli/monitordocker.sh fabric_test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输入命令查看<code>Fabric</code>节点在本地机器上的运行情况:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">--format</span> <span class="token string">&quot;table {{.ID}}<span class="token entity" title="\\t">\\t</span>{{.Command}}<span class="token entity" title="\\t">\\t</span>{{.Names}}<span class="token entity" title="\\t">\\t</span>{{.Status}}&quot;</span>

CONTAINER ID   COMMAND                  NAMES                    STATUS
d255f2b9a2c1   <span class="token string">&quot;/bin/bash&quot;</span>              cli                      Up <span class="token number">10</span> minutes
3befc5ce08a0   <span class="token string">&quot;peer node start&quot;</span>        peer0.org1.example.com   Up <span class="token number">10</span> minutes
c45d3f652ed3   <span class="token string">&quot;peer node start&quot;</span>        peer0.org2.example.com   Up <span class="token number">10</span> minutes
4be1c7ac1615   <span class="token string">&quot;tini -- /docker-ent…&quot;</span>   couchdb0                 Up <span class="token number">10</span> minutes
3738079de5ed   <span class="token string">&quot;orderer&quot;</span>                orderer.example.com      Up <span class="token number">10</span> minutes
e367f530c373   <span class="token string">&quot;tini -- /docker-ent…&quot;</span>   couchdb1                 Up <span class="token number">10</span> minutes
7c7bf89f33ab   <span class="token string">&quot;sh -c &#39;fabric-ca-se…&quot;</span>   ca_org1                  Up <span class="token number">11</span> minutes
03cc20c8acfb   <span class="token string">&quot;sh -c &#39;fabric-ca-se…&quot;</span>   ca_org2                  Up <span class="token number">11</span> minutes
97ec75b9892d   <span class="token string">&quot;sh -c &#39;fabric-ca-se…&quot;</span>   ca_orderer               Up <span class="token number">11</span> minutes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看看您是否可以将这些容器映射到基本网络上:</p><ul><li>Org1的peer, <code>peer0.org1.example.com</code>, 在容器<code>3befc5ce08a0</code>上运行</li><li>Org2的peer, <code>peer0.org2.example.com</code>, 在容器<code>c45d3f652ed3</code>上运行</li><li>Org1的peer对应的CouchDB数据库, <code>couchdb0</code>, 在容器<code>4be1c7ac1615</code>上运行</li><li>Org2的peer对应的CouchDB数据库, <code>couchdb1</code>, 在容器<code>e367f530c373</code>上运行</li><li>排序服务节点, <code>orderer.example.com</code>, 在容器<code>3738079de5ed</code>上运行</li><li>Org1的CA, <code>ca_org1</code>, 在容器<code>7c7bf89f33ab</code>上运行</li><li>Org2的CA, <code>ca_org2</code>, 在容器<code>03cc20c8acfb</code>上运行</li><li>排序服务Org的CA, <code>ca_orderer</code>, 在容器<code>97ec75b9892d</code>上运行</li></ul>`,9),y=n("code",null,"fabric_test",-1),I={href:"https://docs.docker.com/network/",target:"_blank",rel:"noopener noreferrer"},x=t(`<p>可以使用 <code>docker network</code> 命令查看该网络:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">docker</span> network inspect fabric_test

<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;fabric_test&quot;</span>,
        <span class="token string">&quot;Id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;b7b954bfcaf19c4896213413845614f2dcde5766ba134da5205ffd8694ceda89&quot;</span>,
        <span class="token string">&quot;Created&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2021-11-18T22:18:43.566324126+08:00&quot;</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bridge&quot;</span>,
        <span class="token string">&quot;EnableIPv6&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;IPAM&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
            <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> null,
            <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;Subnet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.0/20&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.1&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Internal&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Attachable&quot;</span><span class="token builtin class-name">:</span> true,
        <span class="token string">&quot;Ingress&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;ConfigFrom&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Network&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;ConfigOnly&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Containers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;03cc20c8acfb5bba741a907f608916925670bb7a0ba3d7f44aecec7ef6fd5e5d&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ca_org2&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;a27843537558125447af07befea7a9ffcc80916b58699346d10f78e72b8386a9&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:a0:03&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.3/20&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;3738079de5edd3ea5bb1509f3576beb8b75cfe61cc7ec0ee863b7522511168ef&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;orderer.example.com&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;5218296fbc7df7fb293ce09572fae7304ec338683dbe1d69097be52d483cd711&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:a0:07&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.7/20&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;3befc5ce08a0deb4450b54d46b8afb84c9d4759258d5845ef4a2ef5ebc4af2d8&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;peer0.org1.example.com&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2375bf45bb12e4b154727d498bfb2c576b20614ba1db3dd49b2aed160dd0da46&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:a0:09&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.9/20&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;4be1c7ac1615c172d6c76fd4091e77f46ad395e193b3cc532a91b69d755be27d&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;couchdb0&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;49eb384708e0ef9f2cd181389a8da5aa99aeefefefde01d05000411daf0ac107&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:a0:05&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.5/20&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;7c7bf89f33ab646b727cda0f574c1d64b4b22c8500450208ef30fd7a9e52bda0&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ca_org1&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;689493d04a59764cce92d89dd782f0e9e6339453d604d2ff8b0be4acddd5d54d&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:a0:04&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.4/20&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;97ec75b9892dad98ee593d7e7be615b3400146d252b0abea8fc4e40601de5aef&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ca_orderer&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;adcc89bf18bf0ff996c4eb1d2f0a1d60e02928413cd8873663d030f17dfa4775&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:a0:02&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.2/20&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;c45d3f652ed30ad32ba28ea1378917518970e1235d4a45af8b978e714faa2d86&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;peer0.org2.example.com&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1cc6891f016f6ea820714e1f72a24154d16c609b14f033896d5415dfc488ecf5&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:a0:08&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.8/20&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;d255f2b9a2c181298d23179a9fdf56ba4bb8a3dcdb28afd001d934ecfedb7610&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;cli&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;5c0186b60ab42ac53ded8000c570cbc2a86fed7383f84644bb1a03fc12a37e2c&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:a0:0a&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.10/20&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;e367f530c3731260175aa12d5c19f9fe0dc1e92c685e21b323c586282c485bb6&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;couchdb1&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;502eb45ee4e18909345b3ad5da74c6e0a415724be698cc377c7081425f801946&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:a0:06&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.160.6/20&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;com.docker.compose.network&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;fabric_test&quot;</span>,
            <span class="token string">&quot;com.docker.compose.project&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;docker&quot;</span>,
            <span class="token string">&quot;com.docker.compose.version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1.29.2&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看这八个容器如何在作为单个<code>Docker</code>网络一部分的同时使用不同的 IP 地址。</p><p>您将以 DigiBank 和 MagnetCorp 的身份来操作测试网络，<code>peer0.org1.example.com</code>将由 DigiBank 组织操作， 而<code>peer0.org2.example.com</code>将由 MagnetoCorp 组织操作。</p><p>测试网络已经启动并运行， 从现在开始可以将这个网络称为<code>PaperNet</code>。</p><p>下面首先您将扮演 MagnetoCorp 的角色来交易商业票据。</p><h2 id="四、以-magnetocorp-的身份管理网络" tabindex="-1"><a class="header-anchor" href="#四、以-magnetocorp-的身份管理网络" aria-hidden="true">#</a> 四、以 MagnetoCorp 的身份管理网络</h2><blockquote><p>商业票据教程允许您通过为<code>DigiBank</code>和<code>MagnetoCorp</code>提供两个单独的文件夹来充当两个组织。 这两个文件夹包含每个组织的智能合约和应用程序文件。 由于这两个组织在商业票据交易中有不同的角色， 所以每个组织的应用程序文件也不同。</p></blockquote><p>在<code>fabric-samples</code>仓库下打开一个新窗口， 并使用以下命令切换到 MagnetoCorp 目录:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cd commercial-paper/organization/magnetocorp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,10),A=n("code",null,"PaperNet",-1),w=n("code",null,"logspout",-1),M={href:"https://github.com/gliderlabs/logspout#logspout",target:"_blank",rel:"noopener noreferrer"},D=n("strong",null,"将不同输出流采集到一个地方",-1),j=t(`<p>在 MagnetoCorp 目录下，运行下列命令以运行<code>monitordocker.sh</code>脚本</p><p>并为运行在<code>fabric_test</code>上的与<code>PaperNet</code>相关联的容器启动<code>logspout</code>工具:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>magnetocorp admin<span class="token punctuation">)</span>$ ./configuration/cli/monitordocker.sh fabric_test

<span class="token punctuation">..</span>.
latest: Pulling from gliderlabs/logspout
<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>
Starting monitoring on all containers on the network net_test
b7f3586e5d0233de5a454df369b8eadab0613886fc9877529587345fc01a3582
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，如果<code>monitordocker.sh</code>中的默认端口已经在使用，您可以传入一个端口号。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>magnetocorp admin<span class="token punctuation">)</span>$ ./monitordocker.sh net_test <span class="token operator">&lt;</span>port_number<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>现在，这个窗口将为本教程剩余部分显示<code>Docker</code>容器的日志输出。</p><p>继续并打开另一个命令窗口，下一件事是检查 MagnetoCorp 将用于发行商业票据的智能合约。</p><h2 id="五、检查商业票据智能合约" tabindex="-1"><a class="header-anchor" href="#五、检查商业票据智能合约" aria-hidden="true">#</a> 五、检查商业票据智能合约</h2><p><code>issue</code>, <code>buy</code> 和<code>redeem</code>是<code>PaperNet</code>智能合约的三个<strong>核心功能</strong>。应用程序使用这些功能来提交交易，相应地，在账本上会发行、购买和赎回商业票据。我们接下来的任务就是检查这个智能合约。</p><p>打开一个新的终端窗口来代表 MagnetoCorp 开发人员。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> commercial-paper/organization/magnetocorp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后，您可以使用您选择的编辑器(本教程中的VS Code) 在<code>contract</code>目录中查看智能合约:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>magnetocorp developer<span class="token punctuation">)</span>$ code contract
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在这个文件夹的<code>lib</code>目录下，您将看到<code>papercontract.js</code>文件，其中包含了商业票据<strong>智能合约</strong></p><figure><img src="https://raw.githubusercontent.com/Jxpro/PicBed/master/md/2021/11/2021-11-19-193537.png" alt="commercialpaper.vscode1" tabindex="0" loading="lazy"><figcaption>commercialpaper.vscode1</figcaption></figure><p><code>papercontract.js</code>是一个在<code>Node.js</code>中运行的<code>JavaScript</code>程序。注意下面的关键程序行:</p>`,16),B=n("code",null,"const { Contract, Context } = require('fabric-contract-api');",-1),N=n("code",null,"Hyperledger Fabric",-1),E=n("code",null,"Contract",-1),P=n("code",null,"Context",-1),O={href:"https://fabric-shim.github.io/",target:"_blank",rel:"noopener noreferrer"},S=n("code",null,"fabric-shim",-1),T=t("<li><code>class CommercialPaperContract extends Contract {</code> 这里基于内置的<code>Fabric</code> <code>Contract</code> 类定义了智能合约类<code>CommercialPaperContract</code> 。实现了 <code>issue</code>，<code>buy</code> 和<code>redeem</code>商业票据关键交易的方法。</li><li><code>async issue(ctx, issuer, paperNumber, issueDateTime, maturityDateTime...) {</code> 这个方法为<code>PaperNet</code>定义了商业票据<code>issue</code>交易。传入的参数用于创建新的商业票据。找到并检查智能合约内的<code>buy</code>和<code>redeem</code>方法。</li><li><code>let paper = CommercialPaper.createInstance(issuer, paperNumber...);</code> 在<code>issue</code>交易内部，这个语句根据提供的交易输入使用<code>CommercialPaper</code>类在内存中创建了一个新的商业票据。检查<code>buy</code>和<code>redeem</code>交易看如何类似地使用该类。</li><li><code>await ctx.paperList.addPaper(paper);</code> 这个语句使用<code>ctx.paperList</code>在账本上添加了新的商业票据，其中<code>ctx.paperList</code>是<code>PaperList</code>类的一个实例，当智能合约场景<code>CommercialPaperContext</code>被初始化时，就会创建出一个<code>ctx.paperList</code>。再次检查<code>buy</code>和<code>redeem</code>方法，以了解这些方法是如何使用这一类的。</li><li><code>return paper;</code> 该语句返回一个二进制缓冲区，作为来自<code>issue</code>交易的响应，供智能合约的调用者处理。</li>",5),U=n("p",null,[s("欢迎检查"),n("code",null,"contract"),s("目录下的其他文件来理解智能合约是如何工作的")],-1),z={href:"https://hyperledger-fabric.readthedocs.io/en/latest/developapps/smartcontract.html",target:"_blank",rel:"noopener noreferrer"},R=n("code",null,"papercontract.js",-1),F=n("h2",{id:"六、将智能合约部署到通道",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#六、将智能合约部署到通道","aria-hidden":"true"},"#"),s(" 六、将智能合约部署到通道")],-1),G=n("code",null,"papercontract",-1),$=n("code",null,"peer",-1),J={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/chaincode_lifecycle.html#chaincode-lifecycle",target:"_blank",rel:"noopener noreferrer"},V=n("p",null,[n("code",null,"Fabric"),n("strong",null,"链码生命周期"),s("允许多个组织在链码被部署到通道之前同意链码的参数。 因此，我们需要以 MagnetoCorp 和 DigiBank 的管理员的身份来安装和审批同意链码。")],-1),W=n("figure",null,[n("img",{src:"https://raw.githubusercontent.com/Jxpro/PicBed/master/md/2021/11/2021-11-19-195001.png",alt:"commercialpaper.install",tabindex:"0",loading:"lazy"}),n("figcaption",null,"commercialpaper.install")],-1),H=n("blockquote",null,[n("p",null,[s("MagnetoCorp 的管理员将 "),n("code",null,"papercontract"),s(" 的一个副本安装在 MagnetoCorp 的节点上。")])],-1),L={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/chaincode.html",target:"_blank",rel:"noopener noreferrer"},Q=n("code",null,"Hyperledger Fabric",-1),K=n("strong",null,"一个或多个智能合约",-1),Z=n("code",null,"PaperNet",-1),Y=t(`<h3 id="_6-1-以-magnetocorp-的身份安装和批准智能合约" tabindex="-1"><a class="header-anchor" href="#_6-1-以-magnetocorp-的身份安装和批准智能合约" aria-hidden="true">#</a> 6.1 以 MagnetoCorp 的身份安装和批准智能合约</h3><p>我们将首先以 MagnetoCorp 管理员的身份安装并同意智能合约。 确保您正在<code>magnetocorp</code>文件夹里操作， 或使用以下命令浏览至该文件夹:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> commercial-paper/organization/magnetocorp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>MagnetoCorp 管理员可以通过使用<code>peer</code>CLI与<code>PaperNet</code>交互。</p><p>然而，管理员需要在其命令窗口中设置某些环境变量， 以使用正确的<code>peer</code>二进制文件集，向 MagnetoCorp 的<code>peer</code>节点的地址发送命令和使用正确的加密资料对请求进行签名。</p><p>您可以使用示例提供的脚本在命令窗口中设置环境变量，在<code>magnetocorp</code>目录中执行如下命令:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">source</span> magnetocorp.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>您将在窗口中看到被打印出来的环境变量的完整列表。 我们现在可以使用这个命令窗口来以 MagnetoCorp 管理员的身份与<code>PaperNet</code>交互。</p><p>第一步是安装<code>papercontract</code>智能合约。 可以使用<code>peer lifecycle chaincode package</code>命令 将智能合约打包成链码。 在 MagnetoCorp 管理员的命令窗口中， 执行如下命令<strong>创建链码包</strong>:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>magnetocorp admin<span class="token punctuation">)</span>$ peer lifecycle chaincode package cp.tar.gz <span class="token parameter variable">--lang</span> <span class="token function">node</span> <span class="token parameter variable">--path</span> ./contract <span class="token parameter variable">--label</span> cp_0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>MagnetoCorp 管理员现在可以使用<code>peer lifecycle chaincode install</code>命令 在 MagnetoCorp 的<code>peer</code>节点上<strong>安装链码</strong>:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>magnetocorp admin<span class="token punctuation">)</span>$ peer lifecycle chaincode <span class="token function">install</span> cp.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>安装过程中<strong>日志输出</strong>:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>sad_mirzakhani<span class="token operator">|</span>+ <span class="token assign-left variable">INPUT_DIR</span><span class="token operator">=</span>/chaincode/input
sad_mirzakhani<span class="token operator">|</span>+ <span class="token assign-left variable">OUTPUT_DIR</span><span class="token operator">=</span>/chaincode/output
sad_mirzakhani<span class="token operator">|</span>+ <span class="token function">cp</span> <span class="token parameter variable">-R</span> /chaincode/input/src/. /chaincode/output
sad_mirzakhani<span class="token operator">|</span>+ <span class="token builtin class-name">cd</span> /chaincode/output
sad_mirzakhani<span class="token operator">|</span>+ <span class="token string">&#39;[&#39;</span> <span class="token parameter variable">-f</span> package-lock.json <span class="token parameter variable">-o</span> <span class="token parameter variable">-f</span> npm-shrinkwrap.json <span class="token punctuation">]</span>
sad_mirzakhani<span class="token operator">|</span>+ <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--production</span>
  <span class="token punctuation">..</span>.
peer0.org2.example.com<span class="token operator">|</span><span class="token number">2021</span>-11-19 <span class="token number">12</span>:13:19.012 UTC <span class="token punctuation">[</span>lifecycle<span class="token punctuation">]</span> InstallChaincode -<span class="token operator">&gt;</span> INFO 049 Successfully installed chaincode with package ID <span class="token string">&#39;cp_0:df23cfaa2d118a48df5002d95521e14df1070e44d7858da6d2da2d9df3f138ce&#39;</span>
peer0.org2.example.com<span class="token operator">|</span><span class="token number">2021</span>-11-19 <span class="token number">12</span>:13:19.013 UTC <span class="token punctuation">[</span>endorser<span class="token punctuation">]</span> callChaincode -<span class="token operator">&gt;</span> INFO 04a finished chaincode: _lifecycle duration: 134016ms <span class="token assign-left variable">channel</span><span class="token operator">=</span> <span class="token assign-left variable">txID</span><span class="token operator">=</span>98b9fc81
peer0.org2.example.com<span class="token operator">|</span><span class="token number">2021</span>-11-19 <span class="token number">12</span>:13:19.018 UTC <span class="token punctuation">[</span>comm.grpc.server<span class="token punctuation">]</span> <span class="token number">1</span> -<span class="token operator">&gt;</span> INFO 04b unary call completed <span class="token assign-left variable">grpc.service</span><span class="token operator">=</span>protos.Endorser <span class="token assign-left variable">grpc.method</span><span class="token operator">=</span>ProcessProposal <span class="token assign-left variable">grpc.peer_address</span><span class="token operator">=</span><span class="token number">192.168</span>.224.1:60024 <span class="token assign-left variable">grpc.code</span><span class="token operator">=</span>OK <span class="token assign-left variable">grpc.call_duration</span><span class="token operator">=</span>2m14.024052285s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在安装了<strong>链码包后</strong>， 您会在您的终端上看到类似如下的消息:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">2021</span>-11-19 <span class="token number">20</span>:13:19.021 CST <span class="token punctuation">[</span>cli.lifecycle.chaincode<span class="token punctuation">]</span> submitInstallProposal -<span class="token operator">&gt;</span> INFO 001 Installed remotely: response:<span class="token operator">&lt;</span>status:200 payload:<span class="token string">&quot;<span class="token entity" title="\\n">\\n</span>Ecp_0:df23cfaa2d118a48df5002d95521e14df1070e44d7858da6d2da2d9df3f138ce<span class="token entity" title="\\022">\\022</span><span class="token entity" title="\\004">\\004</span>cp_0&quot;</span> <span class="token operator">&gt;</span>
<span class="token number">2021</span>-11-19 <span class="token number">20</span>:13:19.021 CST <span class="token punctuation">[</span>cli.lifecycle.chaincode<span class="token punctuation">]</span> submitInstallProposal -<span class="token operator">&gt;</span> INFO 002 Chaincode code package identifier: cp_0:df23cfaa2d118a48df5002d95521e14df1070e44d7858da6d2da2d9df3f138ce
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>因为 MagnetoCorp 管理员已经设置了<code>CORE_PEER_ADDRESS=localhost:9051</code> ，将<code>peer0.org2.example.com</code>作为指令的目标，所以<code>INFO 001 Installed remotely...</code>表示 <code>papercontract</code>已被成功安装在此<code>peer</code>节点上。</p><p>在安装智能合约之后，我们需要以 MagnetoCorp 的身份<strong>同意</strong><code>papercontract</code>的<strong>链码定义</strong>:</p><p>第一步是找到我们安装在我们的<code>peer</code>上的链码的 packageID。我们可以使用<code>peer lifecycle chaincode queryinstalled</code> 命令<strong>查询packageID</strong>:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>peer lifecycle chaincode queryinstalled
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>该命令将返回与安装命令相同的<strong>包标识符</strong>，您应该会看到类似如下的输出:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 终端输出</span>
Installed chaincodes on peer:
Package ID: cp_0:df23cfaa2d118a48df5002d95521e14df1070e44d7858da6d2da2d9df3f138ce, Label: cp_0

<span class="token comment"># 日志输出</span>
peer0.org2.example.com<span class="token operator">|</span><span class="token number">2021</span>-11-19 <span class="token number">12</span>:20:11.498 UTC <span class="token punctuation">[</span>endorser<span class="token punctuation">]</span> callChaincode -<span class="token operator">&gt;</span> INFO 04e finished chaincode: _lifecycle duration: 0ms <span class="token assign-left variable">channel</span><span class="token operator">=</span> <span class="token assign-left variable">txID</span><span class="token operator">=</span>db6de531
peer0.org2.example.com<span class="token operator">|</span><span class="token number">2021</span>-11-19 <span class="token number">12</span>:20:11.498 UTC <span class="token punctuation">[</span>comm.grpc.server<span class="token punctuation">]</span> <span class="token number">1</span> -<span class="token operator">&gt;</span> INFO 04f unary call completed <span class="token assign-left variable">grpc.service</span><span class="token operator">=</span>protos.Endorser <span class="token assign-left variable">grpc.method</span><span class="token operator">=</span>ProcessProposal <span class="token assign-left variable">grpc.peer_address</span><span class="token operator">=</span><span class="token number">192.168</span>.224.1:33218 <span class="token assign-left variable">grpc.code</span><span class="token operator">=</span>OK <span class="token assign-left variable">grpc.call_duration</span><span class="token operator">=</span><span class="token number">730.336</span>µs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在下一步中，我们将需要<code>packageID</code>， 因此我们将其<strong>保存为一个环境变量</strong>。 对于所有用户，package ID可能不相同， 因此您需要使用从命令窗口返回的<code>packageID</code>来完成这个步骤。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">PACKAGE_ID</span><span class="token operator">=</span>cp_0:df23cfaa2d118a48df5002d95521e14df1070e44d7858da6d2da2d9df3f138ce
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>管理员现在可以使用<code>peer lifecycle chaincode approveformyorg</code>命令为 MagnetoCorp 同意链码定义:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>magnetocorp admin<span class="token punctuation">)</span>$ peer lifecycle chaincode approveformyorg <span class="token parameter variable">--orderer</span> localhost:7050 <span class="token parameter variable">--ordererTLSHostnameOverride</span> orderer.example.com <span class="token parameter variable">--channelID</span> mychannel <span class="token parameter variable">--name</span> papercontract <span class="token parameter variable">-v</span> <span class="token number">0</span> --package-id <span class="token variable">$PACKAGE_ID</span> <span class="token parameter variable">--sequence</span> <span class="token number">1</span> <span class="token parameter variable">--tls</span> <span class="token parameter variable">--cafile</span> <span class="token variable">$ORDERER_CA</span>

<span class="token comment"># 终端输出</span>
<span class="token number">2021</span>-11-19 <span class="token number">20</span>:21:22.675 CST <span class="token punctuation">[</span>chaincodeCmd<span class="token punctuation">]</span> ClientWait -<span class="token operator">&gt;</span> INFO 001 txid <span class="token punctuation">[</span>d26e938dce3a0ea7315a0d16f581b682a13dc3a039561582e16d5f579942d1bf<span class="token punctuation">]</span> committed with status <span class="token punctuation">(</span>VALID<span class="token punctuation">)</span> at localhost:9051
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,26),X={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/endorsement-policies.html",target:"_blank",rel:"noopener noreferrer"},nn=n("code",null,"--policy",-1),sn=n("code",null,"papercontract",-1),an=n("code",null,"Endorsement",-1),en=n("code",null,"mychannel",-1),tn={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/ledger/ledger.html#blockchain",target:"_blank",rel:"noopener noreferrer"},on={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/ledger/ledger.html#world-state",target:"_blank",rel:"noopener noreferrer"},cn=t(`<h3 id="_6-2-以-digibank-的身份安装和批准智能合约" tabindex="-1"><a class="header-anchor" href="#_6-2-以-digibank-的身份安装和批准智能合约" aria-hidden="true">#</a> 6.2 以 DigiBank 的身份安装和批准智能合约</h3><p>基于<code>mychannel</code>的<code>LifecycleEndorsement</code>策略，<code>Fabric</code>链码生命周期将要求通道上的大多数组织在将链码提交到通道之前同意链码的定义。 这意味着我们需要以 MagnetoCorp 和 DigiBank 的身份同意<code>papernet</code>链码，以达成所需的多数即2/2的要求。在<code>fabric-samples</code>文件夹下打开一个新的终端窗口，并浏览到包含 DigiBank 智能合约和应用程序文件的文件夹:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>digibank admin<span class="token punctuation">)</span>$ <span class="token builtin class-name">cd</span> commercial-paper/organization/digibank/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用<code>digibank</code>文件夹中的脚本设置环境变量， 这将允许您作为 DigiBank 管理员操作:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">source</span> digibank.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>我们现在可以以 DigiBank 的身份安装和同意<code>papercontract</code>。 执行如下命令<strong>打包链码</strong>:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>digibank admin<span class="token punctuation">)</span>$ peer lifecycle chaincode package cp.tar.gz <span class="token parameter variable">--lang</span> <span class="token function">node</span> <span class="token parameter variable">--path</span> ./contract <span class="token parameter variable">--label</span> cp_0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>管理员现在可以在 DigiBank 的<code>peer</code>节点上<strong>安装链码</strong>:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>digibank admin<span class="token punctuation">)</span>$ peer lifecycle chaincode <span class="token function">install</span> cp.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后我们需要<strong>查询并保存</strong>刚刚安装的链码的packageID:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>digibank admin<span class="token punctuation">)</span>$ peer lifecycle chaincode queryinstalled
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>将 package ID 保存为环境变量。 使用从控制台返回的 package ID 完成此步骤。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">PACKAGE_ID</span><span class="token operator">=</span>cp_0:f2316bf21cdc9aa6c3650c815228f88b3ae20cd2a74f30a1db76f02be2c4d599
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Digibank 管理员现在可以同意<code>papercontract</code>的链码定义:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>digibank admin<span class="token punctuation">)</span>$ peer lifecycle chaincode approveformyorg <span class="token parameter variable">--orderer</span> localhost:7050 <span class="token parameter variable">--ordererTLSHostnameOverride</span> orderer.example.com <span class="token parameter variable">--channelID</span> mychannel <span class="token parameter variable">--name</span> papercontract <span class="token parameter variable">-v</span> <span class="token number">0</span> --package-id <span class="token variable">$PACKAGE_ID</span> <span class="token parameter variable">--sequence</span> <span class="token number">1</span> <span class="token parameter variable">--tls</span> <span class="token parameter variable">--cafile</span> <span class="token variable">$ORDERER_CA</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_6-3-将链码定义提交到通道" tabindex="-1"><a class="header-anchor" href="#_6-3-将链码定义提交到通道" aria-hidden="true">#</a> 6.3 将链码定义提交到通道</h3><p>现在， DigiBank 和 MagnetoCorp 都同意了<code>papernet</code>链码， 我们有了我们需要的大多数(2/2)组织的条件来提交链码定义到通道。 一旦在通道上成功定义了链码， 通道上的客户端应用程序就可以调用 <code>papercontract</code>链码中的<code>CommercialPaper</code>智能合约。 由于任何一个机构都可以提交链码到通道， 我们将继续以 DigiBank 管理员的身份操作:</p><figure><img src="https://raw.githubusercontent.com/Jxpro/PicBed/master/md/2021/11/18-213356.png" alt="commercialpaper.commit" tabindex="0" loading="lazy"><figcaption>commercialpaper.commit</figcaption></figure><blockquote><p>在 DigiBank 管理员将<code>papercontract</code>链码的定义提交到通道后，将创建一个新的Docker链码容器，以便在PaperNet的两个peer节点上运行<code>papercontract</code></p></blockquote><p>DigiBank 管理员使用<code>peer lifecycle chaincode commit</code>命令 将<code>papercontract</code>的链码定义提交到<code>mychannel</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>digibank admin<span class="token punctuation">)</span>$ peer lifecycle chaincode commit <span class="token parameter variable">-o</span> localhost:7050 <span class="token parameter variable">--ordererTLSHostnameOverride</span> orderer.example.com <span class="token parameter variable">--peerAddresses</span> localhost:7051 <span class="token parameter variable">--tlsRootCertFiles</span> <span class="token variable">\${PEER0_ORG1_CA}</span> <span class="token parameter variable">--peerAddresses</span> localhost:9051 <span class="token parameter variable">--tlsRootCertFiles</span> <span class="token variable">\${PEER0_ORG2_CA}</span> <span class="token parameter variable">--channelID</span> mychannel <span class="token parameter variable">--name</span> papercontract <span class="token parameter variable">-v</span> <span class="token number">0</span> <span class="token parameter variable">--sequence</span> <span class="token number">1</span> <span class="token parameter variable">--tls</span> <span class="token parameter variable">--cafile</span> <span class="token variable">$ORDERER_CA</span> <span class="token parameter variable">--waitForEvent</span>

<span class="token comment"># 终端输出</span>
<span class="token number">2021</span>-11-19 <span class="token number">20</span>:35:36.497 CST <span class="token punctuation">[</span>chaincodeCmd<span class="token punctuation">]</span> ClientWait -<span class="token operator">&gt;</span> INFO 001 txid <span class="token punctuation">[</span>2ad5641813aedf1522673e5324470eb5f210a2fd20f28490810c5956d70c3c21<span class="token punctuation">]</span> committed with status <span class="token punctuation">(</span>VALID<span class="token punctuation">)</span> at localhost:7051
<span class="token number">2021</span>-11-19 <span class="token number">20</span>:35:36.497 CST <span class="token punctuation">[</span>chaincodeCmd<span class="token punctuation">]</span> ClientWait -<span class="token operator">&gt;</span> INFO 002 txid <span class="token punctuation">[</span>2ad5641813aedf1522673e5324470eb5f210a2fd20f28490810c5956d70c3c21<span class="token punctuation">]</span> committed with status <span class="token punctuation">(</span>VALID<span class="token punctuation">)</span> at localhost:9051
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>链码容器将在链码定义提交到通道后启动。 您可以使用<code>docker ps</code>命令在两个<code>peer</code>节点上 看到<code>papercontract</code>容器的启动。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>digibank admin<span class="token punctuation">)</span>$ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">--format</span> <span class="token string">&quot;table {{.ID}}<span class="token entity" title="\\t">\\t</span>{{.Command}}<span class="token entity" title="\\t">\\t</span>{{.Status}}&quot;</span>

CONTAINER ID   COMMAND                  STATUS
4f2bd78c1783   <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   Up <span class="token number">2</span> minutes
d705b42ea6a2   <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   Up <span class="token number">2</span> minutes
c45c1fc081c6   <span class="token string">&quot;/bin/logspout&quot;</span>          Up <span class="token number">28</span> minutes
476a151b9592   <span class="token string">&quot;/bin/bash&quot;</span>              Up <span class="token number">31</span> minutes
1c4ba59f7a08   <span class="token string">&quot;peer node start&quot;</span>        Up <span class="token number">31</span> minutes
5cfc4a2d02f1   <span class="token string">&quot;peer node start&quot;</span>        Up <span class="token number">31</span> minutes
a6f8791071c2   <span class="token string">&quot;orderer&quot;</span>                Up <span class="token number">31</span> minutes
4ac511545c11   <span class="token string">&quot;tini -- /docker-ent…&quot;</span>   Up <span class="token number">31</span> minutes
195f375ccbcb   <span class="token string">&quot;tini -- /docker-ent…&quot;</span>   Up <span class="token number">31</span> minutes
f0ce8e80eeeb   <span class="token string">&quot;sh -c &#39;fabric-ca-se…&quot;</span>   Up <span class="token number">31</span> minutes
0c4e6d8cc2d1   <span class="token string">&quot;sh -c &#39;fabric-ca-se…&quot;</span>   Up <span class="token number">31</span> minutes
5f97b2efb970   <span class="token string">&quot;sh -c &#39;fabric-ca-se…&quot;</span>   Up <span class="token number">31</span> minutes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>容器的命名指出了启动它的<code>peer</code>节点， 以及它正在运行<code>papercontract</code>版本<code>0</code>的实际情况。</p><p>现在我们已经将<code>papercontract</code>链代码部署到通道， 我们可以使用 MagnetoCorp 应用程序来发行商业票据。 先让我们花点时间检查一下应用程序的结构。</p><h2 id="七、应用结构" tabindex="-1"><a class="header-anchor" href="#七、应用结构" aria-hidden="true">#</a> 七、应用结构</h2><p>包含在<code>papercontract</code>中的智能合约由 MagnetoCorp 的应用程序 <code>issue.js</code> 调用。Isabella 使用该程序向发行商业票据<code>00001</code>的账本提交一项交易。让我么来检验一下<code>issue</code> 用是怎么工作的。</p><figure><img src="https://raw.githubusercontent.com/Jxpro/PicBed/master/md/2021/11/2021-11-19-204107.png" alt="commercialpaper.application" tabindex="0" loading="lazy"><figcaption>commercialpaper.application</figcaption></figure><blockquote><p><code>gateway</code>允许应用程序专注于交易的生成、提交和响应。它协调不同网络组件之间的交易提案、排序和通知处理。</p></blockquote>`,29),ln=n("code",null,"issue",-1),pn={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/developapps/wallet.html",target:"_blank",rel:"noopener noreferrer"},rn=n("strong",null,"X.509 证书",-1),dn={href:"https://en.wikipedia.org/wiki/Hardware_security_module",target:"_blank",rel:"noopener noreferrer"},un=n("code",null,"issue",-1),mn=n("code",null,"gateway",-1),bn=n("code",null,"Hyperledger Fabric",-1),gn={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/developapps/gateway.html",target:"_blank",rel:"noopener noreferrer"},vn=n("code",null,"Hyperledger Fabric",-1),kn=t(`<p>让我们来检验一下 Isabella 将要使用的<code>issue</code>应用程序，为其打开另一个终端窗口，在<code>fabric-samples</code>中找到 MagnetoCorp 的<code>/application</code>文件夹：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ <span class="token builtin class-name">cd</span> commercial-paper/organization/magnetocorp/application/
<span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ <span class="token function">ls</span>
enrollUser.js       issue.js        package.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>addToWallet.js</code>是 Isabella 将用来把自己的身份装进钱包的程序，而<code>issue.js</code>将使用这一身份通过调用<code>papercontract</code> 来代表 MagnetoCorp 生成商业票据<code>00001</code>。</p><p>切换至包含 MagnetoCorp 的 <code>issue.js</code> 应用程序副本的目录，并检查此目录：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ <span class="token builtin class-name">cd</span> commercial-paper/organization/magnetocorp/application
<span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ code issue.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://raw.githubusercontent.com/Jxpro/PicBed/master/md/2021/11/2021-11-19-204826.png" alt="image-20211119204824495" tabindex="0" loading="lazy"><figcaption>image-20211119204824495</figcaption></figure><p>注意以下在 <code>issue.js</code> 中的关键程序行：</p><ul><li><code>const { Wallets, Gateway } = require(&#39;fabric-network&#39;);</code> 该语句引入两个关键的<code>Hyperledger Fabric</code>软件开发包（SDK）类<code>Wallet</code>和<code>Gateway</code>。</li><li><code>const wallet = await Wallets.newFileSystemWallet(&#39;../identity/user/...&#39;);</code> 该语句表明了应用程序在连接到区块链网络通道上时将使用<code>Isabella</code>钱包。因为 Isabella 的 <strong>X.509 证书</strong>位于本地文件系统中，所以应用程序创建了一个<code>FileSystemWallet</code>。应用程序会在 <code>isabella</code> 钱包中选择一个特定的身份。</li><li><code>await gateway.connect(connectionProfile, connectionOptions);</code> 此行代码使用<code>connectionProfile</code>识别的网关来连接到网络，使用<code>ConnectionOptions</code>当中引用的身份。 查看<code>../gateway/networkConnection.yaml</code>和<code>User1@org1.example.com</code>是如何分别被用于这些值的。</li><li><code>const network = await gateway.getNetwork(&#39;mychannel&#39;);</code> 该语句是将应用程序连接到网络通道<code>mychannel</code>上，<code>papercontract</code>之前就已经在该通道上部署过了。</li><li><code>const contract = await network.getContract(&#39;papercontract&#39;);</code> 该语句是让应用程序可以访问由 <code>papercontract</code> 中的 <code>org.papernet.commercialpaper</code> 命名空间定义的智能合约。一旦应用程序请求了 getContract，那么它就能提交任意在其内实现的交易。</li><li><code>const issueResponse = await contract.submitTransaction(&#39;issue&#39;, &#39;MagnetoCorp&#39;, &#39;00001&#39;, ...);</code> 该行代码是使用在智能合约中定义的<code>issue</code>交易来向网络提交一项交易。 <code>MagnetoCorp</code>，<code>00001</code>… 都是被<code>issue</code>交易用来生成一个新的商业票据的值。</li><li><code>let paper = CommercialPaper.fromBuffer(issueResponse);</code> 此语句是处理<code>issue</code>交易发来的响应。该响应需要从缓冲区被反序列化成<code>paper</code>，这是一个能够被应用程序准确解释的<code>CommercialPaper</code>对象。</li></ul>`,8),hn=n("code",null,"/application",-1),fn=n("code",null,"issue.js",-1),qn={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/developapps/application.html",target:"_blank",rel:"noopener noreferrer"},_n=n("code",null,"issue.js",-1),Cn=n("h2",{id:"八、安装应用程序依赖",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#八、安装应用程序依赖","aria-hidden":"true"},"#"),s(" 八、安装应用程序依赖")],-1),yn=n("code",null,"issue.js",-1),In=n("code",null,"JavaScript",-1),xn=n("code",null,"PaperNet",-1),An=n("code",null,"nodejs",-1),wn=n("code",null,"issue.js",-1),Mn=n("code",null,"js-yaml",-1),Dn={href:"https://www.npmjs.com/package/js-yaml",target:"_blank",rel:"noopener noreferrer"},jn=n("code",null,"issue.js",-1),Bn=n("code",null,"fabric-network",-1),Nn={href:"https://www.npmjs.com/package/fabric-network",target:"_blank",rel:"noopener noreferrer"},En=n("code",null,"Gateway",-1),Pn=n("code",null,"Wallet",-1),On=t(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>const yaml <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">&#39;js-yaml&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const <span class="token punctuation">{</span> Wallets, Gateway <span class="token punctuation">}</span> <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">&#39;fabric-network&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 <code>npm install</code> 命令来安装这些包，安装过程可能需要一分钟：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ <span class="token builtin class-name">cd</span> commercial-paper/organization/magnetocorp/application/
<span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ <span class="token function">npm</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="九、钱包" tabindex="-1"><a class="header-anchor" href="#九、钱包" aria-hidden="true">#</a> 九、钱包</h2><p>还剩最后一步，Isabella 马上就能够运行<code>issue.js</code>来发行 MagnetoCorp 商业票票据<code>00001</code>了</p>`,5),Sn=n("code",null,"issue.js",-1),Tn=n("code",null,"issue.js",-1),Un={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/developapps/wallet.html",target:"_blank",rel:"noopener noreferrer"},zn=t(`<p>运行在<code>PaperNet</code>上的 MagnetoCorp <strong>证书颁发机构</strong><code>ca_org2</code>， 有一个在部署网络时便注册的应用程序用户。 Isabella 可以使用身份名和 secret 为<code>issue.js</code>应用程序生成<strong>X.509加密材料</strong>。 使用CA生成客户端加密资料的过程称为 <strong>enrollment</strong> 。 在实际的应用场景中，网络运营商将向应用程序开发人员提供使用<code>CA</code>所注册的客户端身份的**名称和 secret **。 然后，开发人员将使用证书凭据注册他们的应用程序并与网络交互。</p><p><code>enrollUser.js</code>程序使用<code>fabric-ca-client</code>类生成私有、公共密钥对, 然后发起一个<strong>Certificate Signing Request</strong>给<code>CA</code>。 如果 Isabella 提交的身份名称和 secret 匹配<code>CA</code>注册的证书凭据, <code>CA</code>将发行并签名一个编码了公钥的证书，证明 Isabella 属于 Isabella 签名。</p><p>签名请求完成后， <code>enrollUser.js</code>将私钥和签名证书存储在 Isabella 的钱包中。</p><p>在 Isabella 的终端窗口中运行<code>addToWallet.js</code>程序来把身份信息添加到她的钱包中：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ <span class="token function">node</span> enrollUser.js <span class="token comment"># 或 node addToWallet.js</span>

Wallet path: /root/go/src/github.com/hyperledger/fabric/scripts/fabric-samples/commercial-paper/organization/magnetocorp/identity/user/isabella/wallet
Successfully enrolled client user <span class="token string">&quot;isabella&quot;</span> and imported it into the wallet

<span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ <span class="token function">node</span> addToWallet.js

<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在我们可以把焦点转向这个程序的结果 —— 将用于提交交易到<code>PaperNet</code>的钱包内容:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ <span class="token function">ls</span> <span class="token punctuation">..</span>/identity/user/isabella/wallet/
isabella.id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Isabella 可以在她的钱包中存储多个身份，但在我们的示例中，她只使用一个。<code>wallet</code>文件夹里有一个<code>isabella.id</code>文件， 该文件提供 Isabella 连接到网络所需的信息。 Isabella 使用的其他身份都有自己对应的文件。 您可以打开这个文件，查看JSON文件中<code>issue.js</code>将使用的代表 Isabella 的身份标识信息。 为清晰起见，输出已经进行了格式化。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$  <span class="token function">cat</span> <span class="token punctuation">..</span>/identity/user/isabella/wallet/*
<span class="token punctuation">{</span>
    <span class="token string">&quot;credentials&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;certificate&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;-----BEGIN CERTIFICATE-----<span class="token entity" title="\\n">\\n</span>MIICqjCCAlGgAwIBAgIUB+qJ71iRjQPHeXv5zjVyZi7ml3kwCgYIKoZIzj0EAwIw<span class="token entity" title="\\n">\\n</span>bDELMAkGA1UEBhMCVUsxEjAQBgNVBAgTCUhhbXBzaGlyZTEQMA4GA1UEBxMHSHVy<span class="token entity" title="\\n">\\n</span>c2xleTEZMBcGA1UEChMQb3JnMi5leGFtcGxlLmNvbTEcMBoGA1UEAxMTY2Eub3Jn<span class="token entity" title="\\n">\\n</span>Mi5leGFtcGxlLmNvbTAeFw0yMTExMTkxMjAyMDBaFw0yMjExMTkxMjA3MDBaMF0x<span class="token entity" title="\\n">\\n</span>CzAJBgNVBAYTAlVTMRcwFQYDVQQIEw5Ob3J0aCBDYXJvbGluYTEUMBIGA1UEChML<span class="token entity" title="\\n">\\n</span>SHlwZXJsZWRnZXIxDzANBgNVBAsTBmNsaWVudDEOMAwGA1UEAxMFdXNlcjEwWTAT<span class="token entity" title="\\n">\\n</span>BgcqhkjOPQIBBggqhkjOPQMBBwNCAAS/O9/MRU+4cuzo9wJBhydf+RVO5DQYmtgf<span class="token entity" title="\\n">\\n</span>I45aJ7kJgkrBAc/0yNOTSZUHtJ6J4+jE3fJ8rUSpCH0qe1zcyJgWo4HfMIHcMA4G<span class="token entity" title="\\n">\\n</span>A1UdDwEB/wQEAwIHgDAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBRYHfCuvq8P6wtv<span class="token entity" title="\\n">\\n</span>rBg1ExRDi/wZ4zAfBgNVHSMEGDAWgBQLb3qLxJThLny5Wat/fWcPKC2XSTAiBgNV<span class="token entity" title="\\n">\\n</span>HREEGzAZghdpWnd6OTE1Nzd4N3NuMnBnamVqZjVrWjBYBggqAwQFBgcIAQRMeyJh<span class="token entity" title="\\n">\\n</span>dHRycyI6eyJoZi5BZmZpbGlhdGlvbiI6IiIsImhmLkVucm9sbG1lbnRJRCI6InVz<span class="token entity" title="\\n">\\n</span>ZXIxIiwiaGYuVHlwZSI6ImNsaWVudCJ9fTAKBggqhkjOPQQDAgNHADBEAiB3yYVh<span class="token entity" title="\\n">\\n</span>YaOvDN5q/MZSC0arSjDp/x4y9ansWSrtboti6QIgOEkX8PtFFyhCdnmNk/KFUytm<span class="token entity" title="\\n">\\n</span>a5LQ7XTQrmmAugOkkhE=<span class="token entity" title="\\n">\\n</span>-----END CERTIFICATE-----<span class="token entity" title="\\n">\\n</span>&quot;</span>,
        <span class="token string">&quot;privateKey&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;-----BEGIN PRIVATE KEY-----<span class="token entity" title="\\n">\\n</span>MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQg/aeHrjVPlDz+LKiJ<span class="token entity" title="\\n">\\n</span>RI7C54zKAVwryM9NdbNF7xuM48GhRANCAAS/O9/MRU+4cuzo9wJBhydf+RVO5DQY<span class="token entity" title="\\n">\\n</span>mtgfI45aJ7kJgkrBAc/0yNOTSZUHtJ6J4+jE3fJ8rUSpCH0qe1zcyJgW<span class="token entity" title="\\n">\\n</span>-----END PRIVATE KEY-----<span class="token entity" title="\\n">\\n</span>&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;mspId&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Org2MSP&quot;</span>,
    <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;X.509&quot;</span>,
    <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在文件中您可以注意到以下内容:</p><ul><li><code>&quot;privateKey&quot;:</code> 用来代表 Isabella 签名交易， 但不能被分发到她的直接控制范围之外。</li><li><code>&quot;certificate&quot;:</code> 它包含 Isabella 的公钥和证书颁发机构在创建证书时添加的其他X.509属性。该证书被分发到网络中，以便不同的参与者可以在不同的时间以加密方式验证由 Isabella 的私钥加密过的信息。</li></ul><h2 id="十、发行应用" tabindex="-1"><a class="header-anchor" href="#十、发行应用" aria-hidden="true">#</a> 十、发行应用</h2><p>Isabella 现在可以用 <code>issue.js</code> 来提交一项交易，该交易将发行 MagnetoCorp 商业票据 <code>00001</code>：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>isabella<span class="token punctuation">)</span>$ <span class="token function">node</span> issue.js

Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper issue transaction.
Process issue transaction response.<span class="token punctuation">{</span><span class="token string">&quot;class&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;org.papernet.commercialpaper&quot;</span>,<span class="token string">&quot;currentState&quot;</span>:1,<span class="token string">&quot;issuer&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;MagnetoCorp&quot;</span>,<span class="token string">&quot;paperNumber&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;00001&quot;</span>,<span class="token string">&quot;issueDateTime&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2020-05-31&quot;</span>,<span class="token string">&quot;maturityDateTime&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2020-11-30&quot;</span>,<span class="token string">&quot;faceValue&quot;</span>:5000000,<span class="token string">&quot;mspid&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;Org2MSP&quot;</span>,<span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;MagnetoCorp&quot;</span><span class="token punctuation">}</span>
MagnetoCorp commercial paper <span class="token builtin class-name">:</span> 00001 successfully issued <span class="token keyword">for</span> value <span class="token number">5000000</span>
Transaction complete.
Disconnect from Fabric gateway.
Issue program complete.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从程序输出我们能看到，系统发行了一张 MagnetoCorp 商业票据 00001，面值为 500 万美元。</p><p>如您所见，为实现这一点，应用程序调用了<code>papercontract.js</code>中<code>CommercialPaper</code>智能合约里定义的<code>issue</code>交易。MagnetoCorp 管理员已经在网络上安装并实例化了<code>CommercialPaper</code>智能合约。在<strong>世界状态</strong>里作为一个<strong>矢量状态</strong>来代表新的商业票据的是通过<code>Fabric</code>应用程序编码端口（API）来与账本交互的智能合约，其中最显著的 API 是<code>putState()</code>和<code>getState()</code>。我们即将看到该矢量状态在随后是如何被<code>buy</code>和<code>redeem</code>交易来操作的，这两项交易同样也是定义在那个智能合约中。</p>`,16),Rn=n("code",null,"Fabric",-1),Fn={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/developapps/gateway.html",target:"_blank",rel:"noopener noreferrer"},Gn={href:"https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/developapps/connectoptions.html",target:"_blank",rel:"noopener noreferrer"},$n=t(`<p>现在让我们将重点转换到 DigiBank（将购买商业票据），以遵循 MagnetoCorp <code>00001</code> 的生命周期。</p><h2 id="十一、digibank应用" tabindex="-1"><a class="header-anchor" href="#十一、digibank应用" aria-hidden="true">#</a> 十一、DigiBank应用</h2><p>Balaji 使用 DigiBank 的<code>buy</code>应用程序来向账本提交一项交易，该账本将商业票据<code>00001</code>的<strong>所属权</strong>从 MagnetoCorp 转向 DigiBank。<code>CommercialPaper</code>智能合约与 MagnetoCorp 应用程序使用的相同，但是此次的交易不同，是<code>buy</code>交易而不是<code>issue</code>交易。</p><p>为 Balaji 打开另一个终端窗口。 在 <code>fabric-samples</code> 中，切换到包含<code>buy.js</code>应用程序的 DigiBank 应用程序目录，并用编辑器打开该目录：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>balaji<span class="token punctuation">)</span>$ <span class="token builtin class-name">cd</span> commercial-paper/organization/digibank/application/
<span class="token punctuation">(</span>balaji<span class="token punctuation">)</span>$ code buy.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://raw.githubusercontent.com/Jxpro/PicBed/master/md/2021/11/2021-11-19-211903.png" alt="image-20211119211902103" tabindex="0" loading="lazy"><figcaption>image-20211119211902103</figcaption></figure><blockquote><p>DigiBank 的商业票据目录包含<code>buy.js</code>和<code>redeem.js</code>应用程序。</p></blockquote><p>DigiBank 的<code>buy.js</code>应用程序在结构上与 MagnetoCorp 的<code>issue.js</code>十分相似，但存在两个重要的差异：</p><ul><li><strong>身份</strong>：用户是 DigiBank 的用户<code>Balaji</code>而不是 MagnetoCorp 的<code>Isabella</code><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> wallet <span class="token operator">=</span> <span class="token keyword">await</span> Wallets<span class="token punctuation">.</span><span class="token function">newFileSystemWallet</span><span class="token punctuation">(</span><span class="token string">&#39;../identity/user/balaji/wallet&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>查看应用程序在连接到<code>PaperNet</code>网络上时是如何使用<code>balaji</code>钱包的。<code>buy.js</code> 在 <code>balaji</code> 钱包里选择一个特定的身份。</li><li><strong>交易</strong>：被调用的交易是<code>buy</code>而不是<code>issue</code><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> buyResponse <span class="token operator">=</span> <span class="token keyword">await</span> contract<span class="token punctuation">.</span><span class="token function">submitTransaction</span><span class="token punctuation">(</span><span class="token string">&#39;buy&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;MagnetoCorp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;00001&#39;</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>提交一项<code>buy</code>交易，其值为<code>MagnetoCorp</code>, <code>00001</code>…，<code>CommercialPaper</code>智能合约类使用这些值来将商业票据<code>00001</code>的所属权转换成 DigiBank。</li></ul><h2 id="十二、以-digibank-的身份运行" tabindex="-1"><a class="header-anchor" href="#十二、以-digibank-的身份运行" aria-hidden="true">#</a> 十二、以 DigiBank 的身份运行</h2><p>负责购买和赎回商业票据的 DigiBank 应用程序的结构和 MagnetoCorp 的发行交易十分相似。所以，我们来安装这些应用程序的依赖项，并搭建 Balaji 的钱包，这样一来，Balaji 就能使用这些应用程序购买和赎回商业票据。</p><p>在 Balaji 的终端窗口运行<code>addToWallet.js</code>程序，把身份信息添加到他的钱包中：</p><p><code>addToWallet.js</code>程序为<code>balaji</code>将其身份信息添加到他的钱包中，<code>buy.js</code>和<code>redeem.js</code> 将使用这些身份信息来向<code>PaperNet</code>提交交易。<strong>（ 不应该是enrollUser.js？？？）</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>balaji<span class="token punctuation">)</span>$ <span class="token function">node</span> addToWallet.js <span class="token comment"># 或 node enrollUser.js</span>

Wallet path: /root/go/src/github.com/hyperledger/fabric/scripts/fabric-samples/commercial-paper/organization/digibank/identity/user/balaji/wallet
Successfully enrolled client user <span class="token string">&quot;balaji&quot;</span> and imported it into the wallet

<span class="token punctuation">(</span>balaji<span class="token punctuation">)</span>$ <span class="token function">node</span> addToWallet.js

<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>addToWallet.js</code>程序已经将<code>balaji</code>的身份信息添加到他的钱包中， 该钱包将被<code>buy.js</code>和<code>redeem.js</code>用于向<code>PaperNet</code>提交交易。</p><p>与 Isabella 一样，Balaji 可以在他的钱包中存储多个身份， 但在我们的示例中，他只使用一个。 他在<code>digibank/identity/user/balaji/wallet/balaji.id</code>对应的 id文件 和 Isabella 的非常相似。</p><h2 id="十三、购买应用" tabindex="-1"><a class="header-anchor" href="#十三、购买应用" aria-hidden="true">#</a> 十三、购买应用</h2><p>Balaji 现在可以使用<code>buy.js</code>来提交一项交易，该交易将会把 MagnetoCorp 商业票据<code>00001</code>的所属权转换成 DigiBank。</p><p>在 Balaji 的窗口运行 <code>buy</code> 应用程序：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>balaji<span class="token punctuation">)</span>$ <span class="token function">node</span> buy.js

Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper buy transaction.
Process buy transaction response.
MagnetoCorp commercial paper <span class="token builtin class-name">:</span> 00001 successfully purchased by DigiBank
Transaction complete.
Disconnect from Fabric gateway.
Buy program complete.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>您可看到程序输出为：Balaji 已经代表 DigiBank 成功购买了 MagnetoCorp 商业票据<code>00001</code>。</p><p><code>buy.js</code>调用了<code>CommercialPaper</code>智能合约中定义的<code>buy</code>交易，该智能合约使用<code>Fabric</code>应用程序编程接口（API）<code>putState()</code>和<code>getState()</code>在<strong>世界状态</strong>中<strong>更新</strong>了商业票据<code>00001</code>。如您所见，就智能合约的逻辑来说，购买和发行商业票据的应用程序逻辑彼此十分相似。</p><h2 id="十四、赎回应用" tabindex="-1"><a class="header-anchor" href="#十四、赎回应用" aria-hidden="true">#</a> 十四、赎回应用</h2><p>商业票据<code>00001</code>生命周期的最后一步交易是 DigiBank 从 MagnetoCorp 那里赎回商业票据。Balaji 使用 <code>redeem.js</code> 提交一项交易来执行智能合约中的赎回逻辑。</p><p>在Balaji的窗口运行 <code>redeem</code> 交易：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>balaji<span class="token punctuation">)</span>$ <span class="token function">node</span> redeem.js

Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper redeem transaction.
Process redeem transaction response.
MagnetoCorp commercial paper <span class="token builtin class-name">:</span> 00001 successfully redeemed with MagnetoCorp
Transaction complete.
Disconnect from Fabric gateway.
Redeem program complete.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样地，当<code>redeem.js</code>调用了<code>CommercialPaper</code>中定义的<code>redeem</code>交易时，商业票据<code>00001</code>是如何被成功赎回的。<code>redeem</code>交易在<strong>世界状态</strong>中<strong>更新</strong>了商业票据<code>00001</code>，以此来反映商业票据的所属权又归回其发行方 MagnetoCorp。</p><h2 id="十五、清理" tabindex="-1"><a class="header-anchor" href="#十五、清理" aria-hidden="true">#</a> 十五、清理</h2><p>在您完成商业票据教程后， 您可以使用一个脚本来清理您的环境</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> fabric-samples/commercial-paper
./network-clean.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>除了<code>logspout</code>工具之外， 这个命令还将关闭<code>peer</code>节点、<code>CouchDB</code>容器和网络中的排序节点。 它还会移除我们为 Isabella 和 Balaji 创造的身份标识。</p><p>账本上的所有数据都将丢失。 如果你想再次学习教程，你将从一个干净的初始状态开始。</p>`,32);function Jn(Vn,Wn){const a=c("ExternalLinkIcon");return i(),l("div",null,[r,d,n("p",null,[s("这个教程将展示如何安装和使用商业票据样例应用程序和智能合约。该主题是以任务为导向的， 因此它"),u,s("。如果想更深入地了解这些概念，可以阅读"),n("a",m,[s("开发应用程序"),e(a)]),s("主题。")]),b,n("p",null,[s("商业票据教程是"),g,s("仓库中的示例之一。在开始本教程之前， 确保您已经按照说明安装了Fabric "),n("a",v,[s("准备阶段必备工具"),e(a)]),s("并"),n("a",k,[s("下载示例、二进制文件和Docker映像"),e(a)]),s("。")]),h,n("blockquote",null,[f,n("p",null,[s("每个组织运行自己的证书颁发机构。 两个peer节点、"),n("a",q,[s("状态数据库"),e(a)]),s("、排序服务节点和每个组织CA都在各自的Docker容器中运行。")]),_]),C,n("p",null,[s("所有这些容器构成了被称作"),y,s("的 "),n("a",I,[s("docker 网络"),e(a)])]),x,n("p",null,[s("我们要做的第一件事就是以 MagnetoCorp 的角色监控"),A,s("网络中的组件。管理员可以使用 "),w,n("a",M,[s("工具"),e(a)]),s(" 。该工具可以"),D,s("，从而在一个窗口中就可以轻松看到正在发生的事情。比如，对于正在安装智能合约的管理员或者正在调用智能合约的开发人员来说，这个工具确实很有帮助。")]),j,n("ul",null,[n("li",null,[B,s(" 这个语句引入了两个关键的"),N,s("类："),E,s(" 和 "),P,s("，它们被智能合约广泛使用。您可以在 "),n("a",O,[S,s(" JSDOCS"),e(a)]),s(" 中了解到这些类的更多信息。")]),T]),U,n("p",null,[s("请仔细阅读"),n("a",z,[s("智能合约处理"),e(a)]),s("主题中"),R,s("是如何设计的。")]),F,n("p",null,[s("在应用程序调用"),G,s("之前， 必须将它安装到测试网络中合适的"),$,s("节点上， 然后在通道上使用"),n("a",J,[s("Fabric链码生命周期"),e(a)]),s("调用它。")]),V,W,H,n("p",null,[s("智能合约是应用开发的重点，它被包含在一个名为"),n("a",L,[s("链码"),e(a)]),s("的"),Q,s("构件中。在一个链码中可以定义"),K,s("，安装链码就使得"),Z,s("中的不同组织可以使用其中的智能合约。这意味着只有管理员需要关注链码；其他人都只需关注智能合约。")]),Y,n("p",null,[s("为了使用链码定义，通道成员需要同意的最重要的链码参数之一 是链码"),n("a",X,[s("背书策略"),e(a)]),s("。 背书策略描述了在确定交易有效之前必须背书(执行和签署)的组织集合。通过不指定"),nn,s("标志而同意"),sn,s("链码，MagnetoCorp 管理员将同意使用通道的默认"),an,s("策略，这在"),en,s("测试通道的实例下要求通道上的大多数组织来背书交易。 所有的交易，无论有效还是无效，都将被记录在 "),n("a",tn,[s("区块链账本"),e(a)]),s("上，但只有有效的交易才会更新"),n("a",on,[s("世界状态"),e(a)]),s("。")]),cn,n("p",null,[ln,s("应用程序代表 Isabella 提交交易，它通过从 Isabella 的 "),n("a",pn,[s("钱包"),e(a)]),s(" 中索取其 "),rn,s("来开始运行，此证书可能储存在本地文件系统中或一个硬件安全模块 "),n("a",dn,[s("HSM"),e(a)]),s(" 里。随后，"),un,s("应用程序就能够利用"),mn,s("在通道上提交交易。"),bn,s("的软件开发包（SDK）提供了一个 "),n("a",gn,[s("gateway"),e(a)]),s(" 抽象，因此应用程序在将网络交互托管给网关时能够专注于应用逻辑。网关和钱包使得编写"),vn,s(" 应用程序变得很简单。")]),kn,n("p",null,[s("欢迎检查"),hn,s("目录下的其他文档来了解"),fn,s("是如何工作的，并仔细阅读应用程序 "),n("a",qn,[s("主题"),e(a)]),s(" 中关于如何实现"),_n,s("的内容。")]),Cn,n("p",null,[yn,s("应用程序是用"),In,s("编写的，旨在作为"),xn,s("网络的客户端来在"),An,s("环境中运行。按照惯例，会在多个网络外部的节点包上建立 MagnetoCorp 的应用程序，以此来提升开发的质量和速度。考虑一下"),wn,s("是如何纳入"),Mn,n("a",Dn,[s("包"),e(a)]),s("来处理 YAML 网关连接配置文件的，或者"),jn,s("是如何纳入"),Bn,n("a",Nn,[s("包"),e(a)]),s("来访问"),En,s("和"),Pn,s("类的：")]),On,n("p",null,[s("因为"),Sn,s("代表 Isabella，所以也就代表 MagnetoCorp，"),Tn,s("将会使用 Isabella "),n("a",Un,[s("钱包"),e(a)]),s("中反应以上事实的身份。现在我们需要执行这个一次性的活动，向 Isabella 的钱包中添 X.509 证书。")]),zn,n("p",null,[s("潜在的"),Rn,s("软件开发包（SDK）一直都在处理交易的背书、排序和通知流程，使得应用程序的逻辑变得简单明了；SDK 用"),n("a",Fn,[s("网关"),e(a)]),s("提取出网络细节信息和"),n("a",Gn,[s("连接选项"),e(a)]),s(" ，以此来声明更先进的流程策略。")]),$n])}const Qn=o(p,[["render",Jn],["__file","4.demo_paper.html.vue"]]);export{Qn as default};
